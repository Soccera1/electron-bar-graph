# Electron Bar Graph Build System

This document describes the build system for the Electron Bar Graph application, including the configure script and Makefile.

## Overview

The build system provides:
- **Configure Script**: Autotools-style configuration with dependency checking
- **Makefile**: Standard build targets (build, install, clean, etc.)
- **Emacs Integration**: Optional Emacs support with automatic compilation
- **Dependency Management**: Automatic installation of Node.js, Bun, and Emacs

## Quick Start

```bash
# Basic build
./configure
make
make install

# Build with custom options
./configure --prefix=/opt/electron-bar-graph --enable-debug
make
make install
```

## Configure Script Options

### Installation Options
- `--prefix=DIR`: Installation prefix (default: `/usr/local`)
- `--bindir=DIR`: Binary directory (default: `$prefix/bin`)
- `--datadir=DIR`: Data directory (default: `$prefix/share/electron-bar-graph`)

### Feature Options
- `--enable-emacs`: Enable Emacs integration (default: yes)
- `--disable-emacs`: Disable Emacs integration
- `--build-emacs`: Build Emacs from source if not found

### Build Options
- `--node-version=VER`: Node.js version to use (default: 18)
- `--bun-version=VER`: Bun version to use (default: latest)
- `--build-type=TYPE`: Build type: release, debug (default: release)
- `--enable-debug`: Enable debug mode
- `--verbose`: Verbose output

### Emacs Options
- `--emacs-prefix=DIR`: Emacs installation prefix (default: `$prefix`)

## Makefile Targets

### Build Targets
- `make` or `make build`: Build the application
- `make install`: Install the application
- `make clean`: Clean build files
- `make distclean`: Clean all generated files

### Development Targets
- `make dev`: Start development server
- `make test`: Run tests
- `make package`: Create distribution package

### Help
- `make help`: Show available targets

## Examples

### Basic Installation
```bash
./configure
make
sudo make install
```

### Custom Installation Directory
```bash
./configure --prefix=/opt/electron-bar-graph
make
sudo make install
```

### Development Build
```bash
./configure --enable-debug --verbose
make
make dev
```

### Disable Emacs Integration
```bash
./configure --disable-emacs
make
make install
```

### Build Emacs from Source
```bash
./configure --build-emacs --emacs-prefix=/usr/local/emacs
make
sudo make install
```

## Dependencies

### System Dependencies
The configure script will check for and install:
- **Build Tools**: make, gcc/clang, pkg-config
- **Node.js**: Version 18+ (installed automatically if missing)
- **Bun**: Latest version (installed automatically if missing)

### Emacs Dependencies (if building Emacs)
- **Development Tools**: autoconf, automake
- **GUI Libraries**: libgtk-3-dev, libx11-dev
- **Image Libraries**: libxpm-dev, libjpeg-dev, libpng-dev, libtiff-dev, libgif-dev
- **Security**: libgnutls28-dev

## Configuration Files

### config.h
Generated by the configure script, contains:
- Installation paths
- Feature flags (EMACS_INTEGRATION, DEBUG, VERBOSE)
- Build configuration

### Makefile
Generated by the configure script, provides:
- Build targets
- Installation rules
- Clean targets
- Development targets

## Build Process

1. **Configure**: Run `./configure` with desired options
2. **Build**: Run `make` to build the application
3. **Install**: Run `make install` to install the application

## Emacs Integration

### Automatic Emacs Build
If Emacs is not found and `--build-emacs` is specified:
1. Downloads Emacs source code
2. Configures with minimal dependencies
3. Compiles and installs Emacs
4. Creates symlinks for system-wide access

### Emacs Features
- ASCII art bar graphs
- Interactive commands (C-c C-n, C-c C-e)
- Export to SVG and ASCII formats
- Customizable colors and dimensions

## Troubleshooting

### Common Issues

#### Missing Dependencies
```bash
# Install system dependencies
sudo apt-get update
sudo apt-get install build-essential pkg-config autoconf automake
sudo apt-get install libgtk-3-dev libx11-dev libxpm-dev libjpeg-dev libpng-dev libtiff-dev libgif-dev libgnutls28-dev
```

#### Emacs Build Fails
```bash
# Check dependencies
pkg-config --exists gtk+-3.0 && echo "GTK+3 OK" || echo "GTK+3 missing"
pkg-config --exists x11 && echo "X11 OK" || echo "X11 missing"

# Try building with minimal configuration
./configure --build-emacs --emacs-prefix=/usr/local/emacs
```

#### Node.js/Bun Installation Fails
```bash
# Manual installation
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

curl -fsSL https://bun.sh/install | bash
export PATH="$HOME/.bun/bin:$PATH"
```

### Debug Mode
Enable debug mode for verbose output:
```bash
./configure --enable-debug --verbose
make
```

### Clean Build
If you encounter issues, try a clean build:
```bash
make distclean
./configure
make
```

## Testing

Run the test script to verify the configure script:
```bash
./test-configure.sh
```

## License

This build system follows the same AGPL-3.0-or-later license as the main application.

## Support

For issues with the build system:
1. Check the troubleshooting section
2. Run with `--verbose` for detailed output
3. Check system dependencies
4. Try a clean build with `make distclean`
